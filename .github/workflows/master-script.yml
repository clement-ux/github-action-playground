name: Master Forge Runner

on:
  # DÃ©clencheur via AWS EventBridge (Webhook)
  repository_dispatch:
    types: [run-foundry-script]
  
  # DÃ©clencheur manuel (Bouton GitHub) pour tester facilement
  workflow_dispatch:
    inputs:
      script_name:
        description: 'Nom du script (ex: Counter)'
        required: true
        default: 'Counter'
      extra_args:
        description: 'Arguments supplÃ©mentaires'
        required: false

jobs:
  execute:
    runs-on: ubuntu-latest
    environment: Test
    steps:
      - uses: actions/checkout@v3
      - uses: foundry-rs/foundry-toolchain@v1
      
      - name: Run Dynamic Script
        run: |
          # Petite astuce pour gÃ©rer soit le dÃ©clencheur AWS, soit le manuel
          SCRIPT_NAME="${{ github.event.client_payload.script_name || inputs.script_name }}"
          EXTRA_ARGS="${{ github.event.client_payload.extra_args || inputs.extra_args }}"
          
          echo "ðŸš€ Lancement du script: $SCRIPT_NAME"
          
          forge script script/$SCRIPT_NAME.s.sol \
            --rpc-url ${{ secrets.RPC_URL }} \
            --private-key ${{ secrets.PRIVATE_KEY }} \
            --broadcast \
            $EXTRA_ARGS